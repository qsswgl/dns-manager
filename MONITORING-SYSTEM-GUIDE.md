# DNS API ç›‘æ§ç³»ç»Ÿé…ç½®æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ DNS API æœåŠ¡ç›‘æ§è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«ï¼š
- **Windows å®¢æˆ·ç«¯ç›‘æ§**: å®šæœŸæ£€æŸ¥æœåŠ¡å¯ç”¨æ€§
- **æœåŠ¡å™¨ç«¯è‡ªæ£€**: æœ¬åœ°å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
- **Docker å¥åº·æ£€æŸ¥**: å®¹å™¨çº§åˆ«çš„å¥åº·ç›‘æ§
- **å¤šç§å‘Šè­¦æ–¹å¼**: æ–‡ä»¶æ—¥å¿—ã€é‚®ä»¶ã€Webhook

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›‘æ§ç³»ç»Ÿæ¶æ„                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Windows å®¢æˆ·ç«¯                 æœåŠ¡å™¨ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚             â”‚                          â”‚
â”‚ monitor-     â”‚   SSH       â”‚  check-dnsapi.sh        â”‚
â”‚ dnsapi-      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (Cron æ¯ 5 åˆ†é’Ÿ)       â”‚
â”‚ service.ps1  â”‚             â”‚                          â”‚
â”‚              â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ (ä»»åŠ¡è®¡åˆ’    â”‚             â”‚  â”‚  Docker          â”‚   â”‚
â”‚  æ¯ 5 åˆ†é’Ÿ)  â”‚             â”‚  â”‚  Healthcheck     â”‚   â”‚
â”‚              â”‚             â”‚  â”‚  (æ¯ 30 ç§’)      â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                             â”‚                          â”‚
      â†“                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â†“
â”‚  å‘Šè­¦ç³»ç»Ÿ    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚
â”‚ â€¢ æ–‡ä»¶æ—¥å¿—   â”‚
â”‚ â€¢ é‚®ä»¶       â”‚
â”‚ â€¢ Webhook    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ç»„ä»¶è¯´æ˜

### 1. Windows ç›‘æ§è„šæœ¬ (`monitor-dnsapi-service.ps1`)

**åŠŸèƒ½**:
- âœ… æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼ˆPing æµ‹è¯•ï¼‰
- âœ… æ£€æŸ¥ç«¯å£ 5075 å¯ç”¨æ€§
- âœ… æµ‹è¯• HTTPS API å¥åº·ç«¯ç‚¹
- âœ… SSH ç™»å½•æ£€æŸ¥å®¹å™¨çŠ¶æ€
- âœ… è‡ªåŠ¨ä¿®å¤ï¼ˆå¯é€‰ï¼‰
- âœ… å¤šç§å‘Šè­¦æ–¹å¼

**è¿è¡Œæ–¹å¼**: Windows ä»»åŠ¡è®¡åˆ’ç¨‹åº

**ä½ç½®**: `K:\DNS\monitor-dnsapi-service.ps1`

### 2. æœåŠ¡å™¨ç«¯ç›‘æ§è„šæœ¬ (`check-dnsapi.sh`)

**åŠŸèƒ½**:
- âœ… æœ¬åœ°å®¹å™¨çŠ¶æ€æ£€æŸ¥
- âœ… æœåŠ¡å¥åº·æ£€æŸ¥
- âœ… é‡å¯ç­–ç•¥éªŒè¯
- âœ… ç³»ç»Ÿèµ„æºç›‘æ§
- âœ… è‡ªåŠ¨ä¿®å¤åŠŸèƒ½
- âœ… æ—¥å¿—è½®è½¬

**è¿è¡Œæ–¹å¼**: Cron å®šæ—¶ä»»åŠ¡

**ä½ç½®**: `/opt/monitor/check-dnsapi.sh`ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

### 3. Docker Compose é…ç½® (`docker-compose.yml`)

**åŠŸèƒ½**:
- âœ… å®¹å™¨å¥åº·æ£€æŸ¥ï¼ˆæ¯ 30 ç§’ï¼‰
- âœ… è‡ªåŠ¨é‡å¯ç­–ç•¥
- âœ… èµ„æºé™åˆ¶
- âœ… æ—¥å¿—ç®¡ç†

**ä½ç½®**: `K:\DNS\server-monitor\docker-compose.yml`

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤ 1: éƒ¨ç½²æœåŠ¡å™¨ç«¯ç›‘æ§

```powershell
# åœ¨ Windows ä¸Šè¿è¡Œ
cd K:\DNS
.\deploy-server-monitor.ps1

# å¦‚æœéœ€è¦éƒ¨ç½² Docker Composeï¼ˆæ¨èï¼‰
.\deploy-server-monitor.ps1 -DeployDockerCompose
```

**è¿™å°†å®Œæˆ**:
- âœ… ä¸Šä¼ ç›‘æ§è„šæœ¬åˆ°æœåŠ¡å™¨ `/opt/monitor/`
- âœ… é…ç½® Cron ä»»åŠ¡ï¼ˆæ¯ 5 åˆ†é’Ÿæ‰§è¡Œï¼‰
- âœ… å¯é€‰ï¼šéƒ¨ç½² Docker Compose é…ç½®

### æ­¥éª¤ 2: é…ç½® Windows ä»»åŠ¡è®¡åˆ’

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell
cd K:\DNS
.\setup-monitoring-task.ps1

# è‡ªå®šä¹‰å‚æ•°
.\setup-monitoring-task.ps1 `
    -IntervalMinutes 5 `
    -EnableAutoFix `
    -EnableAlert `
    -AlertType "file"
```

**è¿™å°†å®Œæˆ**:
- âœ… åˆ›å»º Windows ä»»åŠ¡è®¡åˆ’
- âœ… é…ç½®æ¯ 5 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
- âœ… å¯ç”¨è‡ªåŠ¨ä¿®å¤åŠŸèƒ½
- âœ… é…ç½®å‘Šè­¦æ–¹å¼

### æ­¥éª¤ 3: éªŒè¯éƒ¨ç½²

```powershell
# ç«‹å³è¿è¡Œä¸€æ¬¡æµ‹è¯•
Start-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§"

# æŸ¥çœ‹æ—¥å¿—
Get-Content K:\DNS\logs\monitor.log -Tail 50

# æŸ¥çœ‹å‘Šè­¦æ—¥å¿—
Get-Content K:\DNS\logs\alerts.log -Tail 20
```

---

## âš™ï¸ é…ç½®è¯¦è§£

### Windows ç›‘æ§è„šæœ¬é…ç½®

#### åŸºæœ¬å‚æ•°

```powershell
# æ—¥å¿—æ–‡ä»¶è·¯å¾„
-LogFile "K:\DNS\logs\monitor.log"

# å¯ç”¨/ç¦ç”¨è‡ªåŠ¨ä¿®å¤
-EnableAutoFix $true/$false

# å¯ç”¨/ç¦ç”¨å‘Šè­¦
-EnableAlert $true/$false

# å‘Šè­¦ç±»å‹
-AlertType "file"    # æ–‡ä»¶æ—¥å¿—
-AlertType "email"   # é‚®ä»¶å‘Šè­¦
-AlertType "webhook" # Webhook å‘Šè­¦
```

#### é‚®ä»¶å‘Šè­¦é…ç½®

```powershell
.\monitor-dnsapi-service.ps1 `
    -AlertType "email" `
    -EmailTo "admin@example.com" `
    -EmailFrom "monitor@example.com" `
    -SmtpServer "smtp.example.com" `
    -SmtpPort 587
```

#### Webhook å‘Šè­¦é…ç½®

```powershell
.\monitor-dnsapi-service.ps1 `
    -AlertType "webhook" `
    -WebhookUrl "https://your-webhook-url.com/alert"
```

**Webhook æ•°æ®æ ¼å¼**:
```json
{
  "timestamp": "2025-10-24 10:30:00",
  "level": "ERROR",
  "subject": "æœåŠ¡å¼‚å¸¸",
  "message": "è¯¦ç»†é”™è¯¯ä¿¡æ¯",
  "server": "43.138.35.183",
  "service_url": "https://tx.qsgl.net:5075",
  "container": "dnsapi"
}
```

### æœåŠ¡å™¨ç«¯ç›‘æ§é…ç½®

#### ä¿®æ”¹æ£€æŸ¥é¢‘ç‡

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh -i C:\Key\tx.qsgl.net_id_ed25519 root@43.138.35.183

# ç¼–è¾‘ crontab
crontab -e

# ä¿®æ”¹æ—¶é—´é—´éš”
# æ¯ 3 åˆ†é’Ÿ: */3 * * * * /opt/monitor/check-dnsapi.sh
# æ¯ 10 åˆ†é’Ÿ: */10 * * * * /opt/monitor/check-dnsapi.sh
```

#### è„šæœ¬é…ç½®é¡¹

ç¼–è¾‘ `/opt/monitor/check-dnsapi.sh`:

```bash
# å®¹å™¨åç§°
CONTAINER_NAME="dnsapi"

# æœåŠ¡ URL
SERVICE_URL="http://localhost:5074/api/health"

# æ—¥å¿—æ–‡ä»¶
LOG_FILE="/var/log/dnsapi-monitor.log"
ALERT_FILE="/var/log/dnsapi-alerts.log"

# æœ€å¤§æ—¥å¿—å¤§å°ï¼ˆå­—èŠ‚ï¼‰
MAX_LOG_SIZE=10485760  # 10MB
```

### Docker å¥åº·æ£€æŸ¥é…ç½®

ç¼–è¾‘ `docker-compose.yml`:

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:5074/api/health"]
  interval: 30s        # æ£€æŸ¥é—´éš”
  timeout: 5s          # è¶…æ—¶æ—¶é—´
  retries: 3           # å¤±è´¥é‡è¯•æ¬¡æ•°
  start_period: 15s    # å¯åŠ¨å®½é™æœŸ
```

**å‚æ•°è¯´æ˜**:
- `interval`: å¤šä¹…æ£€æŸ¥ä¸€æ¬¡
- `timeout`: å•æ¬¡æ£€æŸ¥è¶…æ—¶æ—¶é—´
- `retries`: å¤±è´¥å‡ æ¬¡åæ ‡è®°ä¸º unhealthy
- `start_period`: å®¹å™¨å¯åŠ¨åå¤šä¹…æ‰å¼€å§‹æ£€æŸ¥

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### æ£€æŸ¥é¡¹ç›®

| æ£€æŸ¥é¡¹ | è¯´æ˜ | Windows | æœåŠ¡å™¨ | Docker |
|--------|------|---------|--------|--------|
| ç½‘ç»œè¿é€šæ€§ | Ping æµ‹è¯• | âœ… | âœ… | âŒ |
| ç«¯å£å¯ç”¨æ€§ | ç«¯å£ 5075 | âœ… | âŒ | âŒ |
| HTTPS æœåŠ¡ | API å¥åº·æ£€æŸ¥ | âœ… | âœ… | âœ… |
| å®¹å™¨çŠ¶æ€ | Docker ps | âœ… | âœ… | âœ… |
| é‡å¯ç­–ç•¥ | RestartPolicy | âœ… | âœ… | âŒ |
| ç³»ç»Ÿèµ„æº | å†…å­˜/ç£ç›˜ | âŒ | âœ… | âŒ |

### å¥åº·çŠ¶æ€åˆ¤æ–­

| çŠ¶æ€ | æ¡ä»¶ | æ“ä½œ |
|------|------|------|
| âœ… Healthy | æ‰€æœ‰æ£€æŸ¥é€šè¿‡ | æ— æ“ä½œ |
| âš ï¸ Warning | éƒ¨åˆ†æ£€æŸ¥å¤±è´¥ä½†æœåŠ¡å¯ç”¨ | è®°å½•æ—¥å¿— |
| âŒ Error | æœåŠ¡ä¸å¯ç”¨ | è‡ªåŠ¨ä¿®å¤ + å‘Šè­¦ |

---

## ğŸ”§ æ•…éšœå¤„ç†æµç¨‹

### è‡ªåŠ¨ä¿®å¤æµç¨‹

```
å‘ç°å¼‚å¸¸
    â†“
æ£€æŸ¥å®¹å™¨çŠ¶æ€
    â†“
å®¹å™¨å·²åœæ­¢? â”€â”€Yesâ”€â”€â†’ å¯åŠ¨å®¹å™¨
    â†“ No                  â†“
æ£€æŸ¥é‡å¯ç­–ç•¥            éªŒè¯å¯åŠ¨
    â†“                    â†“
ç­–ç•¥ä¸º no? â”€â”€Yesâ”€â”€â†’ è®¾ç½® unless-stopped
    â†“ No                  â†“
æ£€æŸ¥æœåŠ¡å¥åº· â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å¥åº·? â”€â”€Yesâ”€â”€â†’ ä¿®å¤æˆåŠŸ
    â†“ No
å‘é€å‘Šè­¦ï¼ˆéœ€è¦äººå·¥ä»‹å…¥ï¼‰
```

### å‘Šè­¦çº§åˆ«

| çº§åˆ« | æ¡ä»¶ | æ“ä½œ |
|------|------|------|
| INFO | æ­£å¸¸è¿è¡Œ | ä»…è®°å½•æ—¥å¿— |
| WARN | èµ„æºä½¿ç”¨ç‡é«˜ | è®°å½•æ—¥å¿— |
| ERROR | æœåŠ¡ä¸å¯ç”¨ | è‡ªåŠ¨ä¿®å¤ + å‘Šè­¦ |
| CRITICAL | ä¿®å¤å¤±è´¥ | å‘Šè­¦ï¼ˆéœ€è¦äººå·¥å¤„ç†ï¼‰|

---

## ğŸ“ æ—¥å¿—ç®¡ç†

### Windows æ—¥å¿—

**ç›‘æ§æ—¥å¿—**: `K:\DNS\logs\monitor.log`
```
[2025-10-24 10:30:00] [INFO] ========== å¼€å§‹ç›‘æ§æ£€æŸ¥ ==========
[2025-10-24 10:30:01] [INFO] æ£€æŸ¥ç½‘ç»œè¿é€šæ€§...
[2025-10-24 10:30:01] [INFO] æœåŠ¡å™¨ PING æµ‹è¯•é€šè¿‡
[2025-10-24 10:30:02] [SUCCESS] HTTPS æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡: healthy
[2025-10-24 10:30:02] [SUCCESS] æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼ŒæœåŠ¡è¿è¡Œæ­£å¸¸
```

**å‘Šè­¦æ—¥å¿—**: `K:\DNS\logs\alerts.log`
```
========================================
å‘Šè­¦æ—¶é—´: 2025-10-24 10:30:00
========================================
æ—¶é—´: 2025-10-24 10:30:00
çº§åˆ«: ERROR
ä¸»é¢˜: æœåŠ¡å¼‚å¸¸

è¯¦ç»†ä¿¡æ¯:
ç«¯å£ 5075 æ— æ³•è®¿é—®
å®¹å™¨å·²åœæ­¢: Exited (0) 2 hours ago
è‡ªåŠ¨ä¿®å¤: å®¹å™¨å·²é‡æ–°å¯åŠ¨
========================================
```

### æœåŠ¡å™¨æ—¥å¿—

**ç›‘æ§æ—¥å¿—**: `/var/log/dnsapi-monitor.log`

**å‘Šè­¦æ—¥å¿—**: `/var/log/dnsapi-alerts.log`

### æŸ¥çœ‹æ—¥å¿—å‘½ä»¤

```powershell
# Windows
Get-Content K:\DNS\logs\monitor.log -Tail 50 -Wait  # å®æ—¶æŸ¥çœ‹
Get-Content K:\DNS\logs\alerts.log  # æŸ¥çœ‹æ‰€æœ‰å‘Šè­¦

# æœåŠ¡å™¨
ssh -i C:\Key\tx.qsgl.net_id_ed25519 root@43.138.35.183 "tail -f /var/log/dnsapi-monitor.log"
ssh -i C:\Key\tx.qsgl.net_id_ed25519 root@43.138.35.183 "cat /var/log/dnsapi-alerts.log"
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ—¥å¸¸ç›‘æ§

**é…ç½®**: é»˜è®¤é…ç½®å³å¯
- æ£€æŸ¥é¢‘ç‡: æ¯ 5 åˆ†é’Ÿ
- è‡ªåŠ¨ä¿®å¤: å¯ç”¨
- å‘Šè­¦æ–¹å¼: æ–‡ä»¶æ—¥å¿—

**é€‚ç”¨**: 
- å•äººç»´æŠ¤
- æ—¥å¸¸æ£€æŸ¥æ—¥å¿—å³å¯

### åœºæ™¯ 2: å›¢é˜Ÿåä½œ

**é…ç½®**: å¯ç”¨é‚®ä»¶å‘Šè­¦
```powershell
.\setup-monitoring-task.ps1 `
    -IntervalMinutes 5 `
    -AlertType "email" `
    -EmailTo "team@example.com"
```

**é€‚ç”¨**:
- å›¢é˜Ÿç»´æŠ¤
- éœ€è¦åŠæ—¶é€šçŸ¥

### åœºæ™¯ 3: ä¼ä¸šç¯å¢ƒ

**é…ç½®**: Webhook é›†æˆåˆ°ä¼ä¸šé€šçŸ¥ç³»ç»Ÿ
```powershell
.\setup-monitoring-task.ps1 `
    -AlertType "webhook" `
    -WebhookUrl "https://your-system.com/api/alerts"
```

**é€‚ç”¨**:
- ä¼ä¸šå¾®ä¿¡/é’‰é’‰é›†æˆ
- ç»Ÿä¸€å‘Šè­¦å¹³å°

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç›‘æ§è„šæœ¬æœªè¿è¡Œ

**æ£€æŸ¥**:
```powershell
# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
Get-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§"

# æŸ¥çœ‹ä»»åŠ¡å†å²
Get-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§" | Get-ScheduledTaskInfo
```

**è§£å†³**:
```powershell
# å¯ç”¨ä»»åŠ¡
Enable-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§"

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
Start-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§"
```

### é—®é¢˜ 2: æ— æ³•è¿æ¥æœåŠ¡å™¨

**æ£€æŸ¥**:
```powershell
# æµ‹è¯• SSH è¿æ¥
ssh -i C:\Key\tx.qsgl.net_id_ed25519 root@43.138.35.183 "echo 'OK'"

# æ£€æŸ¥å¯†é’¥æƒé™
icacls C:\Key\tx.qsgl.net_id_ed25519
```

### é—®é¢˜ 3: å‘Šè­¦æœªå‘é€

**æ£€æŸ¥æ—¥å¿—**:
```powershell
Get-Content K:\DNS\logs\monitor.log | Select-String "å‘Šè­¦"
```

**éªŒè¯é‚®ä»¶é…ç½®**:
```powershell
# æµ‹è¯• SMTP è¿æ¥
Test-NetConnection -ComputerName smtp.example.com -Port 587
```

### é—®é¢˜ 4: Docker å¥åº·æ£€æŸ¥å¤±è´¥

**æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€**:
```bash
docker ps --format "table {{.Names}}\t{{.Status}}"
docker inspect dnsapi --format='{{.State.Health.Status}}'
```

**æŸ¥çœ‹å¥åº·æ£€æŸ¥æ—¥å¿—**:
```bash
docker inspect dnsapi --format='{{json .State.Health}}' | jq
```

---

## ğŸ“š å‚è€ƒå‘½ä»¤

### Windows ç®¡ç†å‘½ä»¤

```powershell
# æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
Get-ScheduledTask | Where-Object {$_.TaskName -like "*DNS*"}

# ç«‹å³è¿è¡Œ
Start-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§"

# åœæ­¢ä»»åŠ¡
Stop-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§"

# åˆ é™¤ä»»åŠ¡
Unregister-ScheduledTask -TaskName "DNS API æœåŠ¡ç›‘æ§" -Confirm:$false

# æŸ¥çœ‹æ—¥å¿—
Get-Content K:\DNS\logs\monitor.log -Tail 100
Get-Content K:\DNS\logs\alerts.log
```

### æœåŠ¡å™¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹ Cron ä»»åŠ¡
crontab -l

# æ‰‹åŠ¨æ‰§è¡Œç›‘æ§
/opt/monitor/check-dnsapi.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/dnsapi-monitor.log
cat /var/log/dnsapi-alerts.log

# æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€
docker ps
docker inspect dnsapi --format='{{.State.Health.Status}}'
```

### Docker Compose å‘½ä»¤

```bash
# è¿›å…¥éƒ¨ç½²ç›®å½•
cd /opt/dnsapi

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç›‘æ§é¢‘ç‡**
   - ç”Ÿäº§ç¯å¢ƒ: æ¯ 3-5 åˆ†é’Ÿ
   - æµ‹è¯•ç¯å¢ƒ: æ¯ 10-15 åˆ†é’Ÿ

2. **æ—¥å¿—ä¿ç•™**
   - ç›‘æ§æ—¥å¿—: ä¿ç•™ 7 å¤©
   - å‘Šè­¦æ—¥å¿—: é•¿æœŸä¿ç•™

3. **å‘Šè­¦ç­–ç•¥**
   - ä½¿ç”¨å¤šç§å‘Šè­¦æ–¹å¼ï¼ˆæ–‡ä»¶ + é‚®ä»¶/Webhookï¼‰
   - é¿å…å‘Šè­¦ç–²åŠ³ï¼ˆåˆå¹¶ç›¸åŒå‘Šè­¦ï¼‰

4. **è‡ªåŠ¨ä¿®å¤**
   - å¯ç”¨åŸºæœ¬ä¿®å¤ï¼ˆå¯åŠ¨å®¹å™¨ã€è®¾ç½®é‡å¯ç­–ç•¥ï¼‰
   - å¤æ‚é—®é¢˜äººå·¥ä»‹å…¥

5. **å®šæœŸæ£€æŸ¥**
   - æ¯å‘¨æŸ¥çœ‹å‘Šè­¦æ—¥å¿—
   - æ¯æœˆæ£€æŸ¥ç›‘æ§é…ç½®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ç›‘æ§è„šæœ¬: `K:\DNS\monitor-dnsapi-service.ps1`
- éƒ¨ç½²è„šæœ¬: `K:\DNS\deploy-server-monitor.ps1`
- ä»»åŠ¡é…ç½®: `K:\DNS\setup-monitoring-task.ps1`
- Docker é…ç½®: `K:\DNS\server-monitor\docker-compose.yml`

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-24  
**ç»´æŠ¤è€…**: DNS è¿ç»´å›¢é˜Ÿ
