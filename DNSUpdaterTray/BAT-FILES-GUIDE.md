# DNS自动更新器 - 批处理文件使用指南

## 📋 批处理文件列表

便携式安装包现在包含以下批处理文件，可以直接双击运行：

### 1. 安装相关

#### `install-startup.bat` ⭐ **推荐**
- **功能**: 调用PowerShell安装脚本（功能完整）
- **优点**: 
  - ✅ 自动请求管理员权限
  - ✅ 完整的功能（防火墙规则等）
  - ✅ 详细的安装日志
- **使用**: 直接双击运行
- **要求**: 需要PowerShell支持（Windows 7+自带）

#### `install-simple.bat`
- **功能**: 纯批处理实现的简化安装
- **优点**:
  - ✅ 不依赖PowerShell
  - ✅ 适用于受限环境
  - ✅ 快速安装
- **使用**: 右键"以管理员身份运行"
- **限制**: 不配置防火墙规则

### 2. 卸载相关

#### `uninstall-startup.bat`
- **功能**: 完整卸载DNS更新器
- **特性**:
  - ✅ 自动请求管理员权限
  - ✅ 清理所有启动配置
  - ✅ 删除防火墙规则
  - ✅ 可选保留用户配置
- **使用**: 直接双击运行

### 3. 验证相关

#### `verify-autostart.bat`
- **功能**: 验证开机自启动配置
- **特性**:
  - ✅ 检查程序安装状态
  - ✅ 检查启动配置
  - ✅ 检查进程运行状态
  - ✅ 生成详细报告
- **使用**: 直接双击运行（无需管理员权限）

## 🚀 快速开始

### 方式一：完整安装（推荐）

```
1. 解压便携式安装包
2. 双击 install-startup.bat
3. 点击"是"授予管理员权限
4. 等待安装完成
5. 查看任务栏托盘图标 ☕
```

### 方式二：简化安装（适用于特殊环境）

```
1. 解压便携式安装包
2. 右键 install-simple.bat
3. 选择"以管理员身份运行"
4. 等待安装完成
5. 查看任务栏托盘图标 ☕
```

## 📊 批处理文件对比

| 功能 | install-startup.bat | install-simple.bat |
|------|---------------------|-------------------|
| 自动请求管理员权限 | ✅ | ✅ |
| 安装程序文件 | ✅ | ✅ |
| 注册表启动项 | ✅ | ✅ |
| 启动文件夹快捷方式 | ✅ | ✅ |
| 防火墙规则 | ✅ | ❌ |
| 详细日志 | ✅ | ✅ |
| 依赖PowerShell | 是 | 否 |
| 安装速度 | 中等 | 快速 |

## 💡 使用技巧

### 技巧1：双击运行
批处理文件会自动请求管理员权限，无需手动"以管理员身份运行"：
```
双击 install-startup.bat → 点击"是" → 自动完成
```

### 技巧2：静默安装
如果不想看到安装过程，可以最小化命令窗口：
```bat
start /min install-startup.bat
```

### 技巧3：查看详细输出
批处理文件会暂停显示结果，按任意键继续

### 技巧4：故障排查
如果安装失败：
1. 查看错误信息（红色文本）
2. 尝试使用 `install-simple.bat`
3. 手动以管理员身份运行

## 🔍 验证安装

安装完成后，运行验证脚本：
```
双击 verify-autostart.bat
```

验证项目：
- ✅ 程序文件存在
- ✅ 进程正在运行
- ✅ 启动文件夹快捷方式
- ✅ 注册表启动项
- ✅ 防火墙规则
- ✅ 配置文件

## 🗑️ 卸载程序

```
双击 uninstall-startup.bat → 确认卸载 → 完成
```

卸载内容：
- ✅ 停止程序进程
- ✅ 删除启动配置
- ✅ 删除程序文件
- ✅ 删除防火墙规则
- ⚠️ 可选保留用户配置

## ❓ 常见问题

### Q1: 双击批处理文件闪退？
**A**: 这是正常的，批处理在请求管理员权限后会重新启动。看到UAC提示时点击"是"即可。

### Q2: 提示"未找到PowerShell"？
**A**: 使用 `install-simple.bat` 代替，它不需要PowerShell。

### Q3: 防病毒软件拦截？
**A**: 
1. 临时关闭防病毒软件
2. 或添加程序到白名单
3. 使用 `install-simple.bat` 可能会减少拦截

### Q4: 批处理文件损坏或无法执行？
**A**: 
1. 重新下载安装包
2. 检查文件编码（应为ANSI或UTF-8）
3. 使用记事本打开，查看内容是否完整

### Q5: 需要管理员权限吗？
**A**: 
- 安装和卸载：✅ 需要
- 验证：❌ 不需要
- 批处理会自动请求权限

## 🔐 安全说明

### 管理员权限使用说明
批处理文件需要管理员权限来执行以下操作：
- 安装程序到 `C:\Program Files`
- 修改系统注册表
- 创建防火墙规则

### 权限请求方式
```bat
:: 检查是否有管理员权限
net session >nul 2>&1

:: 如果没有，使用PowerShell请求提升
powershell -Command "Start-Process '%~f0' -Verb RunAs"
```

### 安全最佳实践
1. ✅ 从官方渠道下载
2. ✅ 验证文件哈希值
3. ✅ 使用防病毒软件扫描
4. ✅ 检查批处理内容（可用记事本打开）

## 📝 批处理文件内容

### 查看批处理内容
右键批处理文件 → 选择"编辑"或用记事本打开

### 主要步骤（install-startup.bat）
```
1. 检查管理员权限
2. 请求权限提升（如需要）
3. 验证PowerShell可用
4. 检查安装脚本存在
5. 调用PowerShell脚本
6. 显示安装结果
```

### 主要步骤（install-simple.bat）
```
1. 检查管理员权限
2. 请求权限提升（如需要）
3. 检查源文件
4. 停止旧实例
5. 创建安装目录
6. 复制程序文件
7. 配置注册表启动项
8. 创建启动文件夹快捷方式
9. 启动程序
```

## 🎯 推荐使用流程

### 首次安装
```
1. 双击 install-startup.bat（推荐）
   或
   右键 install-simple.bat → 以管理员身份运行

2. 双击 verify-autostart.bat（验证）

3. 右键托盘图标 → 设置（配置DNS）

4. 重启电脑（测试开机自启动）
```

### 升级安装
```
1. 双击 uninstall-startup.bat（先卸载旧版本）

2. 双击 install-startup.bat（安装新版本）

3. 双击 verify-autostart.bat（验证）
```

### 完全卸载
```
1. 双击 uninstall-startup.bat

2. 选择是否保留配置

3. 确认卸载完成
```

## 📞 技术支持

- **项目地址**: https://github.com/qsswgl/dns-manager
- **问题反馈**: 提交Issue
- **使用文档**: README.md

---

**💡 提示**: 推荐使用 `install-startup.bat`，它提供最完整的功能和最好的兼容性！
